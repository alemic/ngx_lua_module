
# Copyright (C) Ngwsx


ngx_addon_name=ngx_lua_module


NGX_LUAJIT=YES

#NGX_LUA_DLL=YES
NGX_LUA_DLL=NO


NGX_LUA_AUTORUN=YES

NGX_LUA_AXIS2C=YES
NGX_LUA_AXIS2C_WS=YES
NGX_LUA_AXIS2C_XML=YES

NGX_LUA_BTT=YES

NGX_LUA_DAHUA=YES

NGX_LUA_DBD=YES
NGX_LUA_DBD_LIBDRIZZLE=YES
NGX_LUA_DBD_SQLITE3=YES

NGX_LUA_FILE=YES
NGX_LUA_LOGGER=YES
NGX_LUA_SMTP=YES
NGX_LUA_SOCKET=YES
NGX_LUA_UTILS=YES

NGX_LUA_HTTP=YES
NGX_LUA_HTTP_LOG=YES
NGX_LUA_HTTP_REQUEST=YES
NGX_LUA_HTTP_RESPONSE=YES
NGX_LUA_HTTP_SESSION=YES
NGX_LUA_HTTP_VARIABLE=YES
NGX_LUA_HTTP_BTT=YES

NGX_LUA_TCP=YES
NGX_LUA_TCP_REQUEST=YES
NGX_LUA_TCP_RESPONSE=YES

NGX_LUA_UDP=YES
NGX_LUA_UDP_REQUEST=YES
NGX_LUA_UDP_BTT=YES

NGX_LUA_UDT=NO
NGX_LUA_UDT_REQUEST=YES
NGX_LUA_UDT_RESPONSE=YES
NGX_LUA_UDT_BTT=NO


if [ "$NGX_PLATFORM" != win32 ]; then
    CORE_LINK="$CORE_LINK -ldl"
fi


if [ "$NGX_LUAJIT" == NO ]; then
    . $ngx_addon_dir/auto/lib/lua/conf
    CORE_LIBS="$CORE_LIBS $LUA_LIBS"
    CORE_INCS="$CORE_INCS $LUA_INCS"
else
    . $ngx_addon_dir/auto/lib/luajit/conf
    CORE_LIBS="$CORE_LIBS $LUAJIT_LIBS"
    CORE_INCS="$CORE_INCS $LUAJIT_INCS"
fi


. $ngx_addon_dir/auto/sources


EVENT_MODULES="$EVENT_MODULES $NGX_LUA_MODULE"
CORE_INCS="$CORE_INCS $NGX_LUA_INCS"
NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_DEPS"
NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_SRCS"

if [ $NGX_LUA_HTTP = YES ]; then
    HTTP_MODULES="$HTTP_MODULES $NGX_LUA_HTTP_MODULE"
    HTTP_INCS="$HTTP_INCS $NGX_LUA_HTTP_INCS"
    NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_HTTP_DEPS"
    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_HTTP_SRCS"
fi

if [ $NGX_LUA_HTTP_LOG = YES ]; then
    HTTP_MODULES="$HTTP_MODULES $NGX_LUA_HTTP_LOG_MODULE"
    HTTP_INCS="$HTTP_INCS $NGX_LUA_HTTP_LOG_INCS"
    NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_HTTP_LOG_DEPS"
    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_HTTP_LOG_SRCS"
fi

if [ $NGX_LUA_TCP = YES ]; then
    EVENT_MODULES="$EVENT_MODULES $NGX_LUA_TCP_MODULES"
    CORE_INCS="$CORE_INCS $NGX_LUA_TCP_INCS"
    NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_TCP_DEPS"
    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_TCP_SRCS"
fi

if [ $NGX_LUA_UDP = YES ]; then
    EVENT_MODULES="$EVENT_MODULES $NGX_LUA_UDP_MODULES"
    CORE_INCS="$CORE_INCS $NGX_LUA_UDP_INCS"
    NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_UDP_DEPS"
    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_UDP_SRCS"
fi

if [ $NGX_LUA_UDT = YES ]; then
    . $ngx_addon_dir/../ngx_udt_module/auto/lib/udt/conf
    CORE_LIBS="$CORE_LIBS $UDT_LIBS"
    CORE_INCS="$CORE_INCS $UDT_INCS"

    EVENT_MODULES="$EVENT_MODULES $NGX_LUA_UDT_MODULES"
    CORE_INCS="$CORE_INCS $NGX_LUA_UDT_INCS"
    NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_UDT_DEPS"
    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_UDT_SRCS"

    have=NGX_UDT . auto/have
fi


if [ $NGX_LUA_AXIS2C = YES ]; then
    . $ngx_addon_dir/auto/lib/axis2c/conf
    CORE_INCS="$CORE_INCS $AXIS2C_INCS"
fi

if [ $NGX_LUA_BTT = YES ]; then
    EVENT_MODULES="$EVENT_MODULES $NGX_BTT_MODULE"
    CORE_INCS="$CORE_INCS $NGX_BTT_INCS"
    NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_BTT_DEPS"
    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_BTT_SRCS"
fi

if [ $NGX_LUA_DBD = YES ]; then
    CORE_INCS="$CORE_INCS $NGX_LUA_DBD_INCS"
    NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_DBD_DEPS"
    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_DBD_SRCS"

    have=NGX_LUA_DBD . auto/have

    if [ $NGX_LUA_DBD_LIBDRIZZLE = YES ]; then
        . $ngx_addon_dir/../ngx_dbd_module/auto/lib/libdrizzle/conf
        CORE_INCS="$CORE_INCS $LIBDRIZZLE_INCS"
        have=NGX_LUA_DBD_LIBDRIZZLE . auto/have
    else
        have=NGX_LUA_DBD_LIBDRIZZLE . auto/nohave
    fi

    if [ $NGX_LUA_DBD_SQLITE3 = YES ]; then
        . $ngx_addon_dir/../ngx_dbd_module/auto/lib/sqlite3/conf
        CORE_INCS="$CORE_INCS $SQLITE3_INCS"
        have=NGX_LUA_DBD_SQLITE3 . auto/have
    else
        have=NGX_LUA_DBD_SQLITE3 . auto/nohave
    fi
else
    have=NGX_LUA_DBD . auto/nohave
fi

if [ $NGX_LUA_UTILS = YES ]; then
    . $ngx_addon_dir/auto/lib/sha1/conf
fi


if [ $NGX_LUA_DLL = NO ]; then

    if [ $NGX_LUA_AUTORUN = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_AUTORUN_SRCS"
    fi

    if [ $NGX_LUA_AXIS2C = YES ]; then
        CORE_LIBS="$CORE_LIBS $AXIS2C_LIBS"
        NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_AXIS2C_DEPS"
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_AXIS2C_SRCS"

        if [ $NGX_LUA_AXIS2C_WS = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_AXIS2C_WS_SRCS"
        fi

        if [ $NGX_LUA_AXIS2C_XML = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_AXIS2C_XML_SRCS"
        fi
    fi

    if [ $NGX_LUA_BTT = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_BTT_SRCS"
    fi

    if [ $NGX_LUA_DAHUA = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_DAHUA_SRCS"
    fi

    if [ $NGX_LUA_DBD = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_DBD_MODULE_SRCS"

        if [ $NGX_LUA_DBD_LIBDRIZZLE = YES ]; then
            CORE_LIBS="$CORE_LIBS $LIBDRIZZLE_LIBS"
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_DBD_LIBDRIZZLE_SRCS"
        fi

        if [ $NGX_LUA_DBD_SQLITE3 = YES ]; then
            CORE_LIBS="$CORE_LIBS $SQLITE3_LIBS"
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_DBD_SQLITE3_SRCS"
        fi
    fi

    if [ $NGX_LUA_FILE = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_FILE_SRCS"
    fi

    if [ $NGX_LUA_LOGGER = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_LOGGER_SRCS"
    fi

    if [ $NGX_LUA_SMTP = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_SMTP_SRCS"
    fi

    if [ $NGX_LUA_SOCKET = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_SOCKET_SRCS"
    fi

    if [ $NGX_LUA_UTILS = YES ]; then
        NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_UTILS_SRCS"
    fi

    if [ $NGX_LUA_HTTP = YES -o $NGX_LUA_HTTP_LOG = YES ]; then
        if [ $NGX_LUA_HTTP_REQUEST = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_HTTP_REQUEST_SRCS"
        fi

        if [ $NGX_LUA_HTTP_RESPONSE = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_HTTP_RESPONSE_SRCS"
        fi

        if [ $NGX_LUA_HTTP_SESSION = YES ]; then
            NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_HTTP_SESSION_DEPS"
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_HTTP_SESSION_SRCS"
        fi

        if [ $NGX_LUA_HTTP_VARIABLE = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_HTTP_VARIABLE_SRCS"
        fi

        if [ $NGX_LUA_BTT = YES -a $NGX_LUA_HTTP_BTT = YES ]; then
            NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_HTTP_BTT_DEPS"
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_HTTP_BTT_SRCS"
        fi
    fi

    if [ $NGX_LUA_TCP = YES ]; then
        if [ $NGX_LUA_TCP_REQUEST = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_TCP_REQUEST_SRCS"
        fi

        if [ $NGX_LUA_TCP_RESPONSE = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_TCP_RESPONSE_SRCS"
        fi
    fi

    if [ $NGX_LUA_UDP = YES ]; then
        if [ $NGX_LUA_UDP_REQUEST = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_UDP_REQUEST_SRCS"
        fi

        if [ $NGX_LUA_BTT = YES -a $NGX_LUA_UDP_BTT = YES ]; then
            NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_UDP_BTT_DEPS"
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_UDP_BTT_SRCS"
        fi
    fi

    if [ $NGX_LUA_UDT = YES ]; then
        if [ $NGX_LUA_UDT_REQUEST = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_UDT_REQUEST_SRCS"
        fi

        if [ $NGX_LUA_UDT_RESPONSE = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_UDT_RESPONSE_SRCS"
        fi

        if [ $NGX_LUA_BTT = YES -a $NGX_LUA_UDT_BTT = YES ]; then
            NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_UDT_BTT_SRCS"
        fi
    fi

    have=NGX_LUA_DLL . auto/nohave

else

    if [ "$NGX_PLATFORM" != win32 ]; then
        CORE_LINK="$CORE_LINK -rdynamic"
    else
        NGX_LUA_DEF="$ngx_addon_dir/src/core/ngx_lua.def"
        CORE_LINK="$CORE_LINK -def:$NGX_LUA_DEF"
        CORE_DEPS="$CORE_DEPS $NGX_LUA_DEF"
    fi

    have=NGX_LUA_DLL . auto/have
fi


USE_MD5=YES
USE_SHA1=YES
