
# Copyright (C) Ngwsx


ngx_addon_name=ngx_lua_module

EVENT_MODULES="$EVENT_MODULES \
    ngx_udp_module \
    ngx_udp_core_module \
    ngx_udp_proxy_module \
    ngx_lua_module \
    ngx_lua_udp_module"

HTTP_MODULES="$HTTP_MODULES ngx_lua_http_module"

HTTP_INCS="$HTTP_INCS \
    $ngx_addon_dir/../ngx_udp_module/src \
    $ngx_addon_dir/src/core \
    $ngx_addon_dir/src/http \
    $ngx_addon_dir/src/udp"

NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
    $ngx_addon_dir/../ngx_udp_module/src/ngx_udp.h"

NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
    $ngx_addon_dir/src/core/ngx_lua.h \
    $ngx_addon_dir/src/core/ngx_lua_dlfcn.h \
    $ngx_addon_dir/src/core/ngx_lua_session.h"

NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
    $ngx_addon_dir/src/http/ngx_lua_http_module.h"

NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
    $ngx_addon_dir/src/udp/ngx_lua_udp_module.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
    $ngx_addon_dir/../ngx_udp_module/src/ngx_udp.c \
    $ngx_addon_dir/../ngx_udp_module/src/ngx_udp_core_module.c \
    $ngx_addon_dir/../ngx_udp_module/src/ngx_udp_handler.c \
    $ngx_addon_dir/../ngx_udp_module/src/ngx_udp_proxy_module.c"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
    $ngx_addon_dir/src/core/ngx_lua.c \
    $ngx_addon_dir/src/core/ngx_lua_cache.c \
    $ngx_addon_dir/src/core/ngx_lua_module.c \
    $ngx_addon_dir/src/core/ngx_lua_parse.c \
    $ngx_addon_dir/src/core/ngx_lua_session.c"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
    $ngx_addon_dir/src/http/ngx_lua_http_module.c"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
    $ngx_addon_dir/src/udp/ngx_lua_udp_module.c"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
    $ngx_addon_dir/src/core/modules/ngx_lua_utils_module.c \
    $ngx_addon_dir/src/core/modules/ngx_lua_http.c"

NGX_LUA_DAHUA_MODULE_SRCS=" \
    $ngx_addon_dir/src/core/modules/ngx_lua_dahua_module.c"

NGX_LUA_FILE_MODULE_SRCS=" \
    $ngx_addon_dir/src/core/modules/ngx_lua_file_module.c"

NGX_LUA_LOGGER_MODULE_SRCS=" \
    $ngx_addon_dir/src/core/modules/ngx_lua_logger_module.c"

NGX_LUA_SMTP_MODULE_SRCS=" \
    $ngx_addon_dir/src/core/modules/ngx_lua_smtp_module.c"

NGX_LUA_SOCKET_MODULE_SRCS=" \
    $ngx_addon_dir/src/core/modules/ngx_lua_socket_module.c"

NGX_LUA_HTTP_REQUEST_MODULE_SRCS=" \
    $ngx_addon_dir/src/http/ngx_lua_http_request_module.c"

NGX_LUA_HTTP_RESPONSE_MODULE_SRCS=" \
    $ngx_addon_dir/src/http/ngx_lua_http_response_module.c"

NGX_LUA_HTTP_SESSION_MODULE_SRCS=" \
    $ngx_addon_dir/src/http/ngx_lua_http_session_module.c"

NGX_LUA_HTTP_VARIABLE_MODULE_SRCS=" \
    $ngx_addon_dir/src/http/ngx_lua_http_variable_module.c"

NGX_LUA_DLL=YES

if [ $NGX_LUA_DLL = NO ]; then

    . $ngx_addon_dir/auto/lib/axis2c/conf

    NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
        $ngx_addon_dir/src/core/ngx_lua_axis2c.h"

    NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
        $ngx_addon_dir/src/core/ngx_lua_axis2c.c \
        $ngx_addon_dir/src/core/modules/ngx_lua_webservice_module.c \
        $ngx_addon_dir/src/core/modules/ngx_lua_xml_module.c"


    . $ngx_addon_dir/../ngx_dbd_module/config-libdrizzle
    . $ngx_addon_dir/../ngx_dbd_module/config-sqlite3

    HTTP_INCS="$HTTP_INCS \
        $ngx_addon_dir/../ngx_dbd_module/src"

    NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
        $ngx_addon_dir/../ngx_dbd_module/src/ngx_dbd.h"

    NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
        $ngx_addon_dir/../ngx_dbd_module/src/ngx_dbd_libdrizzle.c \
        $ngx_addon_dir/../ngx_dbd_module/src/ngx_dbd_sqlite3.c \
        $ngx_addon_dir/src/core/modules/ngx_lua_database_module.c"


    NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
        $NGX_LUA_DAHUA_MODULE_SRCS \
        $NGX_LUA_FILE_MODULE_SRCS \
        $NGX_LUA_LOGGER_MODULE_SRCS \
        $NGX_LUA_SMTP_MODULE_SRCS \
        $NGX_LUA_SOCKET_MODULE_SRCS \
        $NGX_LUA_HTTP_REQUEST_MODULE_SRCS \
        $NGX_LUA_HTTP_RESPONSE_MODULE_SRCS \
        $NGX_LUA_HTTP_SESSION_MODULE_SRCS \
        $NGX_LUA_HTTP_VARIABLE_MODULE_SRCS"

    have=NGX_LUA_DLL . auto/nohave

else

    if [ "$NGX_PLATFORM" != win32 ]; then
        CORE_LINK="$CORE_LINK -rdynamic"
    else
        NGX_LUA_DEF="$ngx_addon_dir/src/core/ngx_lua.def"

        CORE_LINK="$CORE_LINK -def:$NGX_LUA_DEF"

        NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_DEF"
    fi

    have=NGX_LUA_DLL . auto/have
fi

if [ "$NGX_PLATFORM" != win32 ]; then
    CORE_LINK="$CORE_LINK -ldl"
fi

. $ngx_addon_dir/auto/lib/lua/conf
#. $ngx_addon_dir/auto/lib/luajit/conf

USE_MD5=YES
USE_SHA1=YES
