
# Copyright (C) Ngwsx


ngx_addon_name=ngx_lua_module

EVENT_MODULES="$EVENT_MODULES \
    ngx_lua_module"

HTTP_MODULES="$HTTP_MODULES \
    ngx_lua_http_module"

HTTP_INCS="$HTTP_INCS \
    $ngx_addon_dir/src"

NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
    $ngx_addon_dir/src/ngx_lua.h \
    $ngx_addon_dir/src/ngx_lua_dlfcn.h \
    $ngx_addon_dir/src/ngx_lua_http_module.h \
    $ngx_addon_dir/src/ngx_session.h"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
    $ngx_addon_dir/src/ngx_lua.c \
    $ngx_addon_dir/src/ngx_lua_cache.c \
    $ngx_addon_dir/src/ngx_lua_module.c \
    $ngx_addon_dir/src/ngx_lua_parse.c \
    $ngx_addon_dir/src/ngx_lua_http_module.c \
    $ngx_addon_dir/src/ngx_session.c"

NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
    $ngx_addon_dir/src/modules/ngx_lua_core_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_http.c"

NGX_LUA_MODULE_SRCS=" \
    $ngx_addon_dir/src/modules/ngx_lua_dahua_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_file_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_logger_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_request_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_response_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_session_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_smtp_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_socket_module.c \
    $ngx_addon_dir/src/modules/ngx_lua_variable_module.c"

NGX_LUA_DLL=YES

if [ $NGX_LUA_DLL = NO ]; then

    . $ngx_addon_dir/config-axis2c

    NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
        $ngx_addon_dir/src/ngx_lua_axis2c.h"

    NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
        $ngx_addon_dir/src/ngx_lua_axis2c.c \
        $ngx_addon_dir/src/modules/ngx_lua_webservice_module.c \
        $ngx_addon_dir/src/modules/ngx_lua_xml_module.c"


    . $ngx_addon_dir/../ngx_dbd_module/config-libdrizzle
    . $ngx_addon_dir/../ngx_dbd_module/config-sqlite3

    HTTP_INCS="$HTTP_INCS \
        $ngx_addon_dir/../ngx_dbd_module/src"

    NGX_ADDON_DEPS="$NGX_ADDON_DEPS \
        $ngx_addon_dir/../ngx_dbd_module/src/ngx_dbd.h"

    NGX_ADDON_SRCS="$NGX_ADDON_SRCS \
        $ngx_addon_dir/../ngx_dbd_module/src/ngx_dbd_libdrizzle.c \
        $ngx_addon_dir/../ngx_dbd_module/src/ngx_dbd_sqlite3.c \
        $ngx_addon_dir/src/modules/ngx_lua_database_module.c"


    NGX_ADDON_SRCS="$NGX_ADDON_SRCS $NGX_LUA_MODULE_SRCS"

    have=NGX_LUA_DLL . auto/nohave

else

    if [ "$NGX_PLATFORM" != win32 ]; then
        CORE_LINK="$CORE_LINK -rdynamic"
    else
        NGX_LUA_DEF="$ngx_addon_dir/src/ngx_lua_module.def"

        CORE_LINK="$CORE_LINK -def:$NGX_LUA_DEF"

        NGX_ADDON_DEPS="$NGX_ADDON_DEPS $NGX_LUA_DEF"
    fi

    have=NGX_LUA_DLL . auto/have
fi

if [ "$NGX_PLATFORM" != win32 ]; then
    CORE_LINK="$CORE_LINK -ldl"
fi

. $ngx_addon_dir/config-lua
#. $ngx_addon_dir/config-luajit

USE_MD5=YES
USE_SHA1=YES
